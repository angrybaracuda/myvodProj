<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <script src="Script/jquery.min.js" type="text/javascript"></script>
        <script src="Script/json2table.js" type="text/javascript"></script>
        <!--        <script src="Script/jquery.min.js" type="text/javascript"></script>-->
        <script src="http://malsup.github.com/jquery.form.js"></script> 
        <script src="Script/underscore.js" type="text/javascript"></script>
        <script src="Script/JQueryFormSerialize.js" type="text/javascript"></script>
        <meta charset="UTF-8">
        <script src="Script/jsonform.js" type="text/javascript"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <title>TODO supply a title</title>
        <script src="scripts/adminPanel.js" type="text/javascript"></script>
        <script src="scripts/JSON-to-Table-1.0.0.js" type="text/javascript"></script>
        <style>
            div 
            {
                margin:10px;
                border:1px solid black;
            }
        </style>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            /*   $(function () {
             $('#upload-form').ajaxForm({
             success: function (msg) {
             alert("File has been uploaded successfully");
             },
             error: function (msg) {
             $("#upload-error").text("Couldn't upload file");
             }
             });
             });*/
            var form = document.getElementById("upload_form");

            $(form).on("submit", function (e) {
                e.preventDefault();

                $.ajax({
                    url: form.action,
                    type: form.method,
                    data: new FormData(form), // build payload from a Form element
                    contentType: false, // tell jQuery not to adjust content-type
                    processData: false               // tell jQuery not to convert raw data to string
                });
            });
        </script>


        <script>
//            function getVideoData()
//            {
//                var options = {
//                    target: '#fetchedata',
//                    url: 'webapi/admin/addvideo/getvideodata',
//                    method: 'POST',
//                    success: function (x) {
//                        alert('Thanks for your comment!' + x.toString()+'OP');
//                    },
//                    error: function () {
//                        alert('Failed!');
//                    }
//                };
//                $('#video_data').ajaxForm(options);
//            }
            function manuallyEnterVideodata() {
                $('#video_data_get').jsonForm({
                    schema: {

                        "Title": {

                            "type": "string",
                            "title": "Title"
                        },
                        "Year": {

                            "type": "string",
                            "title": "Year"
                        },
                        "languages": {
                            "type": "string",
                            "title": "Languages"

                        },
                        "countries": {
                            "type": "string",
                            "title": "Countries"


                        },
                        "imdbID": {
                            "type": "string",
                            "title": "Imdbid"
                        },
                        "Type": {

                            "type": "string",
                            "title": "Type",
                            "enum": ["Movie", "Series", "Episode"]
                        },
                        "Poster": {

                            "type": "string",
                            "title": "Poster  "
                        },
                        "Plot": {
                            "type": "string",
                            "title": "Plot  "
                        },
                        "Rated": {

                            "type": "string",
                            "title": "Rated"

                        },
                        "Released": {

                            "type": "string",
                            "title": "Released  "
                        },
                        "Runtime": {

                            "type": "string",
                            "title": "Runtime  "
                        },
                        "Genre": {

                            "type": "string",
                            "title": "Genre  "
                        },
                        "Director": {
                            "type": "string",
                            "title": "Director  "
                        },
                        "Writer": {

                            "type": "string",
                            "title": "Writer  "
                        },
                        "Actors": {
                            "type": "string",
                            "title": "Actors  "
                        },
                        "imdbRating": {
                            "type": "string",
                            "title": "Imdbrating  "
                        },
                        "imdbVotes": {
                            "type": "string",
                            "title": "Imdbvotes  "
                        },
                        "DVD": {

                            "type": "string",
                            "title": "Dvd  "


                        },
                        "BoxOffice": {

                            "type": "string",
                            "title": "Boxoffice  "


                        },
                        "Production": {

                            "type": "string",
                            "title": "Production  "


                        },
                        "Website": {

                            "type": "string",
                            "title": "Website"
                        },
                        "Awards": {
                            "type": "string",
                            "title": "Awards  "
                        },
                        "Season": {
                            "type": "number",
                            "title": "Season  "
                        },
                        "Episode": {

                            "type": "number",
                            "title": "Episode  "
                        }
                    }
                    , onSubmit: function (error, values) {
                        console.log(error);
                    }
                });
            }

            function searchVideoData() {
                $("#enter_manually").hide();
                var formData = jQuery('#video_data').serializeJSON();
                var jsonString = JSON.stringify(formData);
                console.log(jsonString);
                $.ajax({
                    type: "POST",
                    url: "webapi/admin/addvideo/getvideodata",
                    data: jsonString,
                    success: function (x) {

                        //console.log(x);
                        if (x.response == true)
                        {
                            videoData = x;
                            console.log(JSON.stringify(x));
                            $("#video_data_get").hide();
                        } else
                        {
                            alert('Could not find the data please enter manually');
                            manuallyEnterVideodata();
                            $("#fetch_omdb").hide();
                            $("#video_data_get").show();

                        }
                    },
                    error: function (x) {
                        alert(x.toString());
                        console.log(x);
                    },
                    dataType: "json",
                    contentType: "application/json"
                });
            }
        </script>
        <script>
            window.onload = function () {
                var dropbox = document.getElementById("dropbox");
                dropbox.addEventListener("dragenter", noop, false);
                dropbox.addEventListener("dragexit", noop, false);
                dropbox.addEventListener("dragover", noop, false);
                dropbox.addEventListener("drop", dropUpload, false);
                $("#enter_manually").hide();
            }

            function noop(event) {
                event.stopPropagation();
                event.preventDefault();
            }

            function dropUpload(event) {
                noop(event);
                var files = event.dataTransfer.files;

                for (var i = 0; i < files.length; i++) {
                    upload(files[i]);
                }
            }

            function upload(file) {
                document.getElementById("status").innerHTML = "Uploading " + file.name;

                var formData = new FormData();
                formData.append("file", file);
                var xhr = new XMLHttpRequest();
                xhr.upload.addEventListener("progress", uploadProgress, false);
                xhr.addEventListener("load", uploadComplete, false);
                xhr.open("POST", "UploadVideo", true); // If async=false, then you'll miss progress bar support.
                xhr.send(formData);
            }

            function uploadProgress(event) {
                // Note: doesn't work with async=false.
                var progress = Math.round(event.loaded / event.total * 100);
                document.getElementById("status").innerHTML = "Progress " + progress + "%";
            }

            function uploadComplete(event) {
                document.getElementById("status").innerHTML = event.target.responseText;
                videoMetadata = JSON.parse("["+event.target.responseText+"]");
                //console.log(event.target.responseText);
                //$.jsontotable(videoMetadata, {id: '#jsontotable', header: false });
                $('#jsontotable').createTable(videoMetadata);
                
            }
        </script>
        <style>
            #dropbox {
                width: 200px;
                height: 100px;
                border: 1px solid gray;
                border-radius: 5px;
                padding: 5px;
                color: gray;
            }
            #jsontotable table
            {
                
            }
        </style>
    </head>
    <body>
        <div class="full_wrapper">
            <div class="header_wrapper"></div>
            <div class="container_wrapper">

                <div style="float:left; width:60%;">
                    <form id="video_data" >
                        Video Title: <input type="text" name="title" /><br>
                        Video Category: <input type="text" name="type" /><br>
                        <input id="fetch_omdb" type="button" onclick="searchVideoData()" value="Search For Data" /><br>
                        <!--                        <input id="enter_manually" type="button" onclick="manuallyEnterVideodata()" value="Input Data manually" /><br>-->
                        <p id="fetchedata"></p>
                    </form>
                </div>
                <div style="float:right;  width:35%">
                    <form>
                        <div id="dropbox">Drag and drop a file here...</div>
                        <div id="status"></div>
                        <div id="jsontotable" class="jsontotable">
                        </div>
                    </form>
                </div>
                <div style="clear:both;"></div>
                <form id="video_data_get" method="post" action="webapi/admin/addvideo/manuallyEnterVideoData">
                    <input id="fetch_omdb" type="button" onclick="searchVideoData()" value="Search For Data" /><br>

                </form>
            </div>
        </div>
        <button  id ="upload" class="btn btn-block btn-success" onclick="finalizeUpload()" style="width:60%; margin: 0px auto;" >Finish</button>
    </body>

</html>
